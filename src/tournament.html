<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Page</title>

    <link rel="stylesheet" href="./assets/css/background.css" />

    <link rel="icon" type="image/png" href="/assets/icon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/assets/icon/favicon.svg" />
    <link rel="shortcut icon" href="/assets/icon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icon/apple-touch-icon.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script src="/assets/js/Enums.js"></script>
    <script src="./assets/js/utils/CustomError.js"></script>
    <script src="./assets/js/repositories/RoutesInfo.js"></script>
    <script src="/assets/js/Generics.js"></script>

    <script src="./assets/js/components/PaginationComponent.js"></script>
    
    <script src="./assets/js/components/HeaderComponent.js"></script>
    <script src="./assets/js/Header.js"></script>

    <script src="./assets/js/repositories/RoomRepository.js"></script>
    <script src="./assets/js/repositories/RankingRepository.js"></script>
    <script src="./assets/js/components/RoomComponent.js"></script>
    <script src="./assets/js/Rooms.js"></script>
    <script src="./assets/js/Ranking.js"></script>
</head>
<body class="pbg">

    <!-- Header Section -->
    <section id="header-section" class="cover-container bg-light mb-4 d-flex w-100 px-3 mx-auto flex-column"></section>
    <main class="container bg-light d-flex flex-row rounded-4">
        <section id="tournament-brackets" class="w-75 my-2 list-group list-group-flush d-flex flex-colunm align-items-center">
        </section>
        <section id="tournament-action">
            <p class="lead px-3">
                <a onclick="DeleteRoom()" class="btn btn-lg btn-secondary">Close Room</a>
            </p>
            <button id="closeRoomButton" class="btn btn-dark">Close Tournament</button>
        </section>
    </main>

    <div id="connected-ws" style="position: fixed; bottom: 20px; left: 20px; z-index: 9999">
        <h5 class="bi bi-c-circle-fill text-danger"><span style="font-size: 20px"> disconnected</span></h2>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const roomCode = urlParams.get('roomCode');

        function showPlayers() {
            fetch('/assets/tournament.json')
            .then(response => response.json())
            .then(data => {
                let elementButton = document.getElementById("tournament-action")
                elementButton.classList.add("h-100", "d-flex", "flex-column", "align-items-end", "justify-content-end")
                if (data["owner"]) {
                    let btn = document.createElement("button") 
                    btn.classList.add("btn", "btn-dark")
                    btn.innerHTML = "start Game"
                    elementButton.appendChild(btn)
                }
                let elements = document.getElementById("tournament-brackets");
                elements.innerHTML = ""
                let brackets = document.createElement("div")

                let elementSection = document.createElement("div")
                let step = 4
                for (i = 1; i <= data["maxNumberOfPlayers"]; i++) {
                    let player = data["players"][`${i}`]
                    let item = document.createElement("a");
                    item.classList.add("list-group-item", "list-group-item-action", "py-2", "lh-sm", "rounded-4", "mb-1")
                    if (player === null)
                        item.classList.add("bg-dark", "text-white")
                    item.innerHTML = `
                    <div class="d-flex w-100 align-items-center justify-content-between ">
                        <div class="d-flex w-100 align-items-center">
                            <img class="rounded-circle img-thumbnail" style="background-color: ${player === null ? "#000" : player["color"]}" src="${ player === null ? "/assets/img/none.png" : player["urlProfileImage"]}" alt="">
                            <div class="d-flex flex-column ps-2 justify-content-center">
                                <strong class="mb-1">${ player === null ? "None" : player["name"]}</strong>
                                ${player === null ? "<p class='small mb-0'>waiting</p>" : ""}
                            </div>
                        </div>
                        <h3 class="ps-3 text-body-secondary">${i}</h3>
                    </div>
                    `
                    brackets.appendChild(item)
                    if (i % 2 === 0) {
                        brackets.classList.add("my-2")
                        elementSection.appendChild(brackets)
                        brackets = document.createElement("div")
                    }

                    if (i === step) {
                        elementSection.classList.add("w-100", "d-flex", "flex-row", "justify-content-around")
                        elements.appendChild(elementSection)
                        elementSection = document.createElement("div")
                        step += 4
                    }
                }

            })
            .catch(error => console.error('Error:', error));
        }

        window.onload = function() {
            renderHeader(document)
            showPlayers()
            
            document.getElementById("closeRoomButton").onclick = () => {
                console.log("Ol√°")
                DeleteRoom(document, window, roomCode);
            };
        };

    </script>
</body>
</html>