<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Room List Page</title>

	<link rel="stylesheet" href="./assets/css/background.css" />

	<link rel="icon" type="image/png" href="/assets/icon/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/svg+xml" href="/assets/icon/favicon.svg" />
	<link rel="shortcut icon" href="/assets/icon/favicon.ico" />
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/icon/apple-touch-icon.png" />
	<link rel="manifest" href="/assets/icon/site.webmanifest" />

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
		
	<script src="/assets/js/Generics.js"></script>
	<script src="./assets/js/components/HeaderComponent.js"></script>
	<script src="./assets/js/Header.js"></script>
</head>
<body class="pbg">

	<!-- Header Section -->
	<section id="header-section" class="cover-container bg-light mb-4 d-flex w-100 px-3 mx-auto flex-column"></section>

	<main style="height: 85vh;" class="my-5 container">
		<div class="d-flex flex-column align-items-center">
			<canvas width="850px" height="550px" class="bg-light border border-dark" id="myCanvas"></canvas>
		</div>
		<div class="d-flex ">
			<div class="w-75 my-2 list-group list-group-flush d-flex flex-row align-items-center">
				<a href="#" class="me-3 list-group-item list-group-item-action py-3 lh-sm rounded-4 mb-2">
					<div class="d-flex w-100 align-items-center justify-content-between">
						<div class="d-flex w-75 align-items-center">
							<img class="rounded-circle img-thumbnail bg-primary" src="./assets/img/blue.png" alt="">
							<div class="d-flex flex-column ps-2 justify-content-center">
								<strong class="mb-1">Carlinhos</strong>
								<p class="small mb-0">Blue</p>
							</div>
						</div>
						<h3 class="text-body-secondary">4</h3>
					</div>
				</a>
				<h1 class="me-3">X</h1>
				<a href="#" class="list-group-item list-group-item-action py-3 lh-sm rounded-4 mb-2">
					<div class="d-flex w-100 align-items-center justify-content-between">
						<div class="d-flex w-75 align-items-center">
							<img class="rounded-circle img-thumbnail bg-danger" src="./assets/img/red.png" alt="">
							<div class="d-flex flex-column ps-2 justify-content-center">
								<strong class="mb-1">Ranna</strong>
								<p class="small mb-0">Red</p>
							</div>
						</div>
						<h3 class="text-body-secondary">7</h3>
					</div>
				</a>
			</div>
			<div class="w-25 d-flex align-items-center justify-content-end">
				<button class="btn btn-dark">Sair da Partida</button>
			</div>
		</div>
	</main>
	<script>
		const host = window.location.host;
		const endpoint = "/api/v1/game-core/";
		const socket = new WebSocket(`wss://${host}${endpoint}`);
		const canvas = document.getElementById('myCanvas');
		const context = canvas.getContext('2d');
		socket.onopen = function(event) {
			console.log("Conectado ao servidor WebSocket");
			socket.send("Olá, servidor!");
		};

		socket.onmessage = function(event) {
			console.log("Recebido do servidor:", event.data);
			drawOnCanvas(event.data);  // Chama a função para desenhar no canvas
		};

		socket.onclose = function(event) {
			console.log("Desconectado do servidor WebSocket");
		};

		// Função para desenhar no canvas
		function drawOnCanvas(data) {
			// Limpa o canvas
			context.clearRect(0, 0, canvas.width, canvas.height);

			// Aqui você pode definir como os dados recebidos do servidor devem ser desenhados
			// Neste exemplo, vamos assumir que o servidor envia coordenadas para desenhar um círculo

			const parsedData = JSON.parse(data); // Supondo que os dados estão em formato JSON
			const { player_one, ball, player_two } = parsedData; // Desestrutura os dados recebidos

			context.fillStyle = 'blue'; // Cor do player_one
			context.fillRect(player_one.x, player_one.y, player_one.width, player_one.height);

			// Desenha a bola
			context.fillStyle = 'red'; // Cor da bola
			context.beginPath();
			context.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
			context.fill(); // Preenche a bola

			// Desenha player_two
			context.fillStyle = 'green'; // Cor do player_two
			context.fillRect(player_two.x, player_two.y, player_two.width, player_two.height);
		}

		// Função para enviar comandos do teclado
		function sendKey(event) {
			const key = event.key;  // Captura a tecla pressionada
			console.log(`Tecla pressionada: ${key}`);
			socket.send(`${key}`);  // Envia a tecla para o servidor
		}

		// Adiciona um listener para o evento de teclado
		document.addEventListener('keydown', sendKey);

		window.onload = function() {
			renderHeader(document)
		}
	</script>
</body>
</html>
